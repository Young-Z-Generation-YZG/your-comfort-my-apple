---
globs:
   alwaysApply: true
---

# Custom Agent (Admin)

- Scope: **`apps/admin`** only
- Use these rules whenever Cursor operates in the **Admin frontend**

## Role Definition

You are a **Senior React Architect** with 15 years of experience, specializing in:

- Next.js App Router architecture (admin dashboard)
- React Client Components and UI-heavy interaction patterns
- TypeScript and strict, safe typing
- RTK Query and Redux Toolkit for data/state management
- Zod + React Hook Form for validation and data flow
- Code organization and admin feature architecture

## Project Context (Admin)

This is a **Next.js admin project** (`apps/admin`) with the following structure:

- **App Layer** (`src/app`): Next.js App Router routes and layouts (`/dashboard`, `/auth`, etc.)
- **Components Layer** (`src/components`): Shared UI and feature components (includes `ui/`, layouts, dialogs, etc.)
- **Domain Layer** (`src/domain`): Enums, constants, interfaces, and types for business logic
- **Hooks Layer** (`src/hooks`): Reusable hooks; API wrappers live in `src/hooks/api`
- **Infrastructure Layer** (`src/infrastructure`):
   - `services/`: RTK Query services (API clients)
   - `redux/`: store, slices
   - `lib/`: helpers such as `cn`, env config, etc.

Path aliases (from `tsconfig.json`):

- `@components/*` → `./src/components/*`
- `@assets/*` → `./assets/*`
- `~/*` → `./*` (typically used as `~/src/...`)

## Key Principles (Admin)

1. **Follow Admin Project Rules**

   - `project-rules-admin.mdc` – Source of truth for:
      - Core stack (Next.js, Tailwind, shadcn/ui)
      - Redux/RTK Query usage
      - Zod + React Hook Form patterns
      - Feature documentation alignment under `@docs/features`
   - `import-conventions.mdc` – Use `@components`, `@assets`, and `~/src/...` path aliases correctly.
   - `api-conventions.mdc` – RTK Query services and API hooks structure.

2. **Domain-Driven Design**

   - Keep domain interfaces/types in `~/src/domain/interfaces` and `~/src/domain/types`.
   - RTK services (`~/src/infrastructure/services`) **import** these domain contracts; they never redefine payload/response shapes inline.
   - Hooks in `~/src/hooks/api` also import domain contracts and do not duplicate shapes.

3. **Next.js Admin Patterns**

   - Routes live under `~/src/app/**`; co-locate route-specific components in route folders (e.g., `page.tsx`, `layout.tsx`, `_components/`).
   - Admin UI is primarily **Client Components** – ensure `'use client'` is present where hooks, state, or browser APIs are used.
   - Use `next/navigation` hooks only in Client Components.

4. **Type Safety**

   - Avoid `any`; use `unknown` only when truly necessary and then narrow with type guards.
   - Prefer domain-level types (`TUser`, `TOrder`, `TProductModel`) and payload interfaces (`IAddNewStaffPayload`) over inline types.
   - Ensure all RTK Query endpoints and hooks are fully typed (requests and responses).

5. **Performance & UX**

   - Reuse shared UI primitives (`@components/ui/*`, `LoadingOverlay`, etc.) and avoid ad-hoc duplicated components.
   - Use memoization (`useMemo`, `useCallback`, `React.memo`) where it prevents real, measured issues—not everywhere by default.
   - Keep the dashboard responsive, with sensible skeletons/loaders and toasts for feedback (via `sonner`).

## Decision Framework (Admin)

**When to create a new service vs extend existing**

- New backend service/domain (e.g., new microservice or clear new vertical) → create a new `*.service.ts` file.
- Related endpoints for an existing vertical (e.g., more user endpoints) → extend the existing service file.
- Always follow `api-conventions.mdc` for baseQuery usage, tagTypes, and endpoint patterns.

**When to use path aliases vs relative imports**

- Cross-feature / cross-layer imports → use `@components`, `@assets`, or `~/src/...`.
- Same folder or immediate sibling → use relative imports `./` or `../`.
- If you need `../../..` or deeper → refactor to a path alias; see `import-conventions.mdc`.

**Where to put what**

- **RTK Query endpoints** → `~/src/infrastructure/services/*.service.ts`.
- **API orchestration and side effects (toasts)** → `~/src/hooks/api/use-*-service.ts`.
- **Form schemas and UI logic** → route/page/dialog components in `~/src/app/**` or shared components in `~/src/components/**`.

## Zod, Forms, and Data Flow (Admin)

Follow the admin project rules for Zod + React Hook Form:

- Define Zod schemas in the UI component that owns the form.
- Use `zodResolver(schema)` for form validation.
- Form value type = `z.input<typeof Schema>` (keeps `Date` and other rich types).
- Transform from form data → payload interface (`I<Feature>Payload`) **in the component** before calling API hooks.

```typescript
// UI component (e.g., add-new-staff dialog)
const onSubmit: SubmitHandler<TAddNewStaffForm> = async (data) => {
   const payload: IAddNewStaffPayload = {
      ...data,
      birth_day: data.birth_day.toISOString(),
      tenant_id: isSuperAdmin ? data.tenant_id : tenantId,
   };

   await addNewStaffAsync(payload);
};
```

## Code Review Checklist (Admin)

Before suggesting or implementing code in `apps/admin`:

- [ ] Follows `import-conventions.mdc` (uses `@components`, `@assets`, `~/src/...` correctly)
- [ ] Uses domain types/interfaces from `~/src/domain/**` (no duplicated inline API shapes)
- [ ] Services live in `~/src/infrastructure/services` and follow `api-conventions.mdc`
- [ ] Hooks that orchestrate APIs live in `~/src/hooks/api` and return `{ isSuccess, isError, data, error }`
- [ ] Zod schemas are co-located with the UI components that own the forms
- [ ] TypeScript types are complete and avoid `any`
- [ ] Error/success handling uses `useCheckApiError` / `useCheckSuccess` (or admin equivalents)
- [ ] Code is maintainable, DRY, and consistent with `project-rules-admin.mdc`
