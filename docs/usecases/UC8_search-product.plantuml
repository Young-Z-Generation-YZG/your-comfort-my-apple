@startuml UC8_search-product
actor Actor
boundary ProductListPage
control CatalogController
control GetIphoneModelsHandler
control MongoRepository
database MongoDB

Actor -> ProductListPage: 1. input(textSearch)
activate Actor
activate ProductListPage

ProductListPage -> CatalogController: 2. getIphoneModels(query)
activate CatalogController

CatalogController -> GetIphoneModelsHandler: 3. getIphoneModels(query)
activate GetIphoneModelsHandler

GetIphoneModelsHandler -> GetIphoneModelsHandler: 4. FilterDefinition(query)

GetIphoneModelsHandler -> GetIphoneModelsHandler: 5. filter Regex(name, textSearch)

GetIphoneModelsHandler -> MongoRepository: 6. GetAllAsync(filter)
activate MongoRepository
MongoRepository -> MongoDB: 7. query(filter)
activate MongoDB
MongoDB --> MongoRepository: 8. return(items, totalRecords, totalPages)
deactivate MongoDB
MongoRepository --> GetIphoneModelsHandler: 9. return(items, totalRecords, totalPages)
deactivate MongoRepository

alt items found
    GetIphoneModelsHandler --> CatalogController: 10. return PaginationResponse<IphoneModelResponse>
    CatalogController --> ProductListPage: 11. return PaginationResponse
    ProductListPage --> Actor: 12. display(Product list with pagination)
    opt textSearch provided
        Actor -> ProductListPage: 13. clickOnItem()
        ref over ProductListPage: sd: Xem chi tiết sản phẩm
    end
else items not found
    GetIphoneModelsHandler --> CatalogController: 10.1 return PaginationResponse<IphoneModelResponse>
    deactivate GetIphoneModelsHandler
    note right
        items is empty list (0 items)
    end note
    CatalogController --> ProductListPage: 10.2 return PaginationResponse
    deactivate CatalogController
    ProductListPage --> Actor: 10.3 display("No products found")
    deactivate ProductListPage
    deactivate Actor
end
@enduml

